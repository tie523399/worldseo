# ğŸ”’ æ¬Šé™æª¢æŸ¥æ©Ÿåˆ¶è©³ç´°èªªæ˜

## ğŸ“‹ æ¦‚è¿°

å…¨çƒèº«ä»½è³‡æ–™ç”Ÿæˆå™¨çš„éƒ¨ç½²è…³æœ¬åŒ…å«å®Œæ•´çš„æ¬Šé™æª¢æŸ¥æ©Ÿåˆ¶ï¼Œç¢ºä¿å®‰å…¨æ€§å’Œæœ€ä½³å¯¦è¸ã€‚

---

## ğŸ›¡ï¸ æ¬Šé™æª¢æŸ¥åŸç†

### æ ¸å¿ƒæª¢æŸ¥ä»£ç¢¼

```bash
# æª¢æŸ¥æ˜¯å¦ç‚º root ç”¨æˆ¶
if [ "$EUID" -eq 0 ]; then
    echo "âŒ è«‹ä¸è¦ä½¿ç”¨ root ç”¨æˆ¶åŸ·è¡Œæ­¤è…³æœ¬"
    echo "   è«‹ä½¿ç”¨å…·æœ‰ sudo æ¬Šé™çš„æ™®é€šç”¨æˆ¶"
    exit 1
fi
```

### æª¢æŸ¥æ©Ÿåˆ¶èªªæ˜

1. **`$EUID` è®Šé‡**
   - è¡¨ç¤ºç•¶å‰ç”¨æˆ¶çš„æœ‰æ•ˆç”¨æˆ¶ ID
   - root ç”¨æˆ¶çš„ EUID = 0
   - æ™®é€šç”¨æˆ¶çš„ EUID > 0

2. **æ¢ä»¶åˆ¤æ–·**
   - `[ "$EUID" -eq 0 ]` æª¢æŸ¥æ˜¯å¦ç‚º root ç”¨æˆ¶
   - å¦‚æœç‚ºçœŸï¼Œå‰‡åŸ·è¡ŒéŒ¯èª¤è™•ç†

3. **éŒ¯èª¤è™•ç†**
   - é¡¯ç¤ºéŒ¯èª¤ä¿¡æ¯
   - æä¾›æ­£ç¢ºçš„ä½¿ç”¨æ–¹æ³•
   - é€€å‡ºè…³æœ¬åŸ·è¡Œ

---

## ğŸš« ç‚ºä»€éº¼ç¦æ­¢ä½¿ç”¨ root ç”¨æˆ¶ï¼Ÿ

### 1. å®‰å…¨æ€§é¢¨éšª

```bash
# âŒ å±éšªï¼šä½¿ç”¨ root åŸ·è¡Œ
sudo ./deploy.sh

# âœ… å®‰å…¨ï¼šä½¿ç”¨æ™®é€šç”¨æˆ¶åŸ·è¡Œ
./deploy.sh
```

**é¢¨éšªåŒ…æ‹¬ï¼š**
- è…³æœ¬éŒ¯èª¤å¯èƒ½å½±éŸ¿æ•´å€‹ç³»çµ±
- æª”æ¡ˆæ¬Šé™è¨­ç½®ä¸ç•¶
- æœå‹™é‹è¡Œæ¬Šé™éé«˜
- é›£ä»¥è¿½è¹¤å’Œå¯©è¨ˆ

### 2. æœå‹™é‹è¡Œå•é¡Œ

```bash
# æœå‹™é…ç½®ä¸­çš„ç”¨æˆ¶è¨­ç½®
[Service]
User=www-data
Group=www-data
```

**å•é¡Œï¼š**
- root ç”¨æˆ¶å‰µå»ºçš„æœå‹™å¯èƒ½ç„¡æ³•æ­£ç¢ºåˆ‡æ›åˆ° www-data
- æª”æ¡ˆæ¬Šé™å¯èƒ½ä¸æ­£ç¢º
- æœå‹™å•Ÿå‹•å¤±æ•—

### 3. æœ€ä½³å¯¦è¸

```bash
# éµå¾ªæœ€å°æ¬Šé™åŸå‰‡
æ™®é€šç”¨æˆ¶ + sudo = å®‰å…¨ + éˆæ´»
```

---

## âœ… æ­£ç¢ºçš„ä½¿ç”¨æ–¹æ³•

### 1. å‰µå»ºå…·æœ‰ sudo æ¬Šé™çš„ç”¨æˆ¶

```bash
# å‰µå»ºæ–°ç”¨æˆ¶
sudo adduser worldseo

# æ·»åŠ åˆ° sudo çµ„
sudo usermod -aG sudo worldseo

# åˆ‡æ›åˆ°æ–°ç”¨æˆ¶
su - worldseo
```

### 2. åŸ·è¡Œéƒ¨ç½²è…³æœ¬

```bash
# ä¸‹è¼‰è…³æœ¬
wget https://raw.githubusercontent.com/tie523399/worldseo/main/one-click-deploy.sh

# è¨­ç½®åŸ·è¡Œæ¬Šé™
chmod +x one-click-deploy.sh

# åŸ·è¡Œè…³æœ¬
./one-click-deploy.sh
```

### 3. è…³æœ¬æœƒè‡ªå‹•ä½¿ç”¨ sudo

```bash
# è…³æœ¬å…§éƒ¨æœƒè‡ªå‹•æ·»åŠ  sudo
sudo apt update
sudo apt install -y python3
sudo systemctl start worldseo-api
```

---

## ğŸ” æ¬Šé™æª¢æŸ¥è§¸ç™¼å ´æ™¯

### å ´æ™¯ 1ï¼šç›´æ¥ä½¿ç”¨ root åŸ·è¡Œ

```bash
# âŒ éŒ¯èª¤æ–¹å¼
root@server:~# ./deploy.sh
âŒ è«‹ä¸è¦ä½¿ç”¨ root ç”¨æˆ¶åŸ·è¡Œæ­¤è…³æœ¬
   è«‹ä½¿ç”¨å…·æœ‰ sudo æ¬Šé™çš„æ™®é€šç”¨æˆ¶
```

### å ´æ™¯ 2ï¼šä½¿ç”¨ sudo åŸ·è¡Œè…³æœ¬

```bash
# âŒ éŒ¯èª¤æ–¹å¼
user@server:~$ sudo ./deploy.sh
âŒ è«‹ä¸è¦ä½¿ç”¨ root ç”¨æˆ¶åŸ·è¡Œæ­¤è…³æœ¬
   è«‹ä½¿ç”¨å…·æœ‰ sudo æ¬Šé™çš„æ™®é€šç”¨æˆ¶
```

### å ´æ™¯ 3ï¼šæ­£ç¢ºåŸ·è¡Œ

```bash
# âœ… æ­£ç¢ºæ–¹å¼
user@server:~$ ./deploy.sh
ğŸš€ é–‹å§‹éƒ¨ç½²å…¨çƒèº«ä»½è³‡æ–™ç”Ÿæˆå™¨ç³»çµ±...
```

---

## ğŸ› ï¸ æ¬Šé™ç›¸é—œçš„è…³æœ¬æ“ä½œ

### 1. æª”æ¡ˆæ¬Šé™è¨­ç½®

```bash
# è¨­ç½®ç›®éŒ„æ¬Šé™
sudo chown -R www-data:www-data $APP_DIR
sudo chmod -R 755 $APP_DIR
```

### 2. æœå‹™æ¬Šé™é…ç½®

```bash
# Systemd æœå‹™é…ç½®
[Service]
User=www-data          # æœå‹™é‹è¡Œç”¨æˆ¶
Group=www-data         # æœå‹™é‹è¡Œçµ„
WorkingDirectory=$APP_DIR
```

### 3. ç’°å¢ƒè®Šé‡æª”æ¡ˆæ¬Šé™

```bash
# å‰µå»º .env æª”æ¡ˆ
cp env.example .env
chmod 600 .env          # åªæœ‰æ‰€æœ‰è€…å¯è®€å¯«
```

---

## ğŸ”§ æ•…éšœæ’é™¤

### å•é¡Œ 1ï¼šæ¬Šé™ä¸è¶³

```bash
# éŒ¯èª¤ä¿¡æ¯
âŒ è«‹ä¸è¦ä½¿ç”¨ root ç”¨æˆ¶åŸ·è¡Œæ­¤è…³æœ¬

# è§£æ±ºæ–¹æ¡ˆ
# 1. å‰µå»ºæ™®é€šç”¨æˆ¶
sudo adduser deployuser
sudo usermod -aG sudo deployuser

# 2. åˆ‡æ›ç”¨æˆ¶
su - deployuser

# 3. é‡æ–°åŸ·è¡Œ
./deploy.sh
```

### å•é¡Œ 2ï¼šsudo æ¬Šé™å•é¡Œ

```bash
# æª¢æŸ¥ sudo æ¬Šé™
sudo -l

# å¦‚æœæ²’æœ‰æ¬Šé™ï¼Œç·¨è¼¯ sudoers
sudo visudo

# æ·»åŠ ä»¥ä¸‹è¡Œ
deployuser ALL=(ALL) NOPASSWD: ALL
```

### å•é¡Œ 3ï¼šæª”æ¡ˆæ¬Šé™éŒ¯èª¤

```bash
# æª¢æŸ¥ç•¶å‰ç”¨æˆ¶
whoami

# æª¢æŸ¥æª”æ¡ˆæ¬Šé™
ls -la deploy.sh

# è¨­ç½®æ­£ç¢ºæ¬Šé™
chmod +x deploy.sh
```

---

## ğŸ“Š æ¬Šé™æª¢æŸ¥æµç¨‹åœ–

```
é–‹å§‹åŸ·è¡Œè…³æœ¬
    â†“
æª¢æŸ¥ EUID æ˜¯å¦ç‚º 0
    â†“
æ˜¯ â†’ é¡¯ç¤ºéŒ¯èª¤ä¿¡æ¯ â†’ é€€å‡º
    â†“
å¦ â†’ ç¹¼çºŒåŸ·è¡Œ
    â†“
ä½¿ç”¨ sudo åŸ·è¡Œéœ€è¦æ¬Šé™çš„æ“ä½œ
    â†“
è¨­ç½®æ­£ç¢ºçš„æª”æ¡ˆå’Œæœå‹™æ¬Šé™
    â†“
å®Œæˆéƒ¨ç½²
```

---

## ğŸ¯ æœ€ä½³å¯¦è¸å»ºè­°

### 1. ç”¨æˆ¶ç®¡ç†

```bash
# å‰µå»ºå°ˆé–€çš„éƒ¨ç½²ç”¨æˆ¶
sudo adduser worldseo-deploy
sudo usermod -aG sudo worldseo-deploy

# è¨­ç½® SSH é‡‘é‘°èªè­‰
ssh-copy-id worldseo-deploy@server
```

### 2. è…³æœ¬åŸ·è¡Œ

```bash
# ä½¿ç”¨æ™®é€šç”¨æˆ¶åŸ·è¡Œ
./one-click-deploy.sh

# è…³æœ¬å…§éƒ¨è‡ªå‹•è™•ç†æ¬Šé™
```

### 3. æœå‹™ç®¡ç†

```bash
# ä½¿ç”¨æœå‹™ç®¡ç†è…³æœ¬
./service-manager.sh

# æˆ–ç›´æ¥ä½¿ç”¨ systemctl
sudo systemctl status worldseo-api
```

### 4. æ—¥èªŒæŸ¥çœ‹

```bash
# æŸ¥çœ‹æœå‹™æ—¥èªŒ
sudo journalctl -u worldseo-api -f

# æŸ¥çœ‹ç³»çµ±æ—¥èªŒ
sudo tail -f /var/log/syslog
```

---

## ğŸ” å®‰å…¨å»ºè­°

### 1. å®šæœŸæ›´æ–°

```bash
# æ›´æ–°ç³»çµ±
sudo apt update && sudo apt upgrade

# æ›´æ–°å°ˆæ¡ˆ
cd /www/worldseo
git pull origin main
```

### 2. å‚™ä»½ç­–ç•¥

```bash
# åŸ·è¡Œå‚™ä»½
sudo /www/worldseo/backup.sh

# æª¢æŸ¥å‚™ä»½
ls -la /backup/worldseo/
```

### 3. ç›£æ§æœå‹™

```bash
# æª¢æŸ¥æœå‹™ç‹€æ…‹
sudo systemctl status worldseo-*

# æŸ¥çœ‹è³‡æºä½¿ç”¨
htop
df -h
```

---

## ğŸ“ æŠ€è¡“æ”¯æ´

å¦‚æœé‡åˆ°æ¬Šé™ç›¸é—œå•é¡Œï¼š

1. **æª¢æŸ¥ç”¨æˆ¶èº«ä»½**
   ```bash
   whoami
   id
   ```

2. **æª¢æŸ¥ sudo æ¬Šé™**
   ```bash
   sudo -l
   ```

3. **æŸ¥çœ‹éŒ¯èª¤æ—¥èªŒ**
   ```bash
   sudo journalctl -u worldseo-api -n 50
   ```

4. **é‡æ–°è¨­ç½®æ¬Šé™**
   ```bash
   sudo chown -R www-data:www-data /www/worldseo
   sudo chmod -R 755 /www/worldseo
   ```

æ¬Šé™æª¢æŸ¥æ©Ÿåˆ¶ç¢ºä¿äº†éƒ¨ç½²éç¨‹çš„å®‰å…¨æ€§å’Œç©©å®šæ€§ï¼ 